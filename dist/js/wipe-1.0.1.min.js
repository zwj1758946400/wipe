/*!weip-zwj 1.0.1 发布日期: 18y-11-14*/
var moveX,moveY,con=document.getElementById("cas"),context=cas.getContext("2d"),radius=20,_w=cas.width,_h=cas.height,isMouseDown=!1,device=/android|webos|iPhone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase());console.log(navigator.userAgent),console.log(device);var clickEvtName=device?"touchstart":"mousedown",moveEvt=device?"touchstart":"mousemove",endEvt=device?"touchstart":"mouseup";function drawMask(e){e.beginPath(),e.fillStyle="#666",e.fillRect(0,0,_w,_h),e.fill(),e.globalCompositeOperation="destination-out"}function drawarc(e,t,o){e.beginPath(),e.fillStyle="red",e.arc(t,o,radius,0,2*Math.PI),e.fill(),e.restore()}function drawLine(e,t,o,n,i){console.log("传递的实参个数"+arguments.length),e.save(),e.lineCap="round",e.lineWidth=2*radius,e.beginPath(),e.moveTo(t,o),e.lineTo(n,i),e.lineJoin="round",e.stroke(),e.restore()}function drawarc(e,t,o){console.log("传递的实参个数"+arguments.length),e.beginPath(),e.fillStyle="red",e.arc(t,o,radius,0,2*Math.PI),e.fill(),e.restore()}function drawT(e,t,o,n,i){3===arguments.length?(e.beginPath(),e.fillStyle="red",e.arc(moveX,moveY,radius,0,2*Math.PI),e.fill(),e.restore()):5===arguments.length&&(e.save(),e.lineCap="round",e.lineWidth=2*radius,e.beginPath(),e.moveTo(t,o),e.lineTo(n,i),e.lineJoin="round",e.stroke(),e.restore())}function fn3(){isMouseDown=!1,50<getTransparencyPercent(context)&&(alert("超过了50%的面积"),clearRect(context))}function getTransparencyPercent(e){for(var t=0,o=e.getImageData(0,0,_w,_h),n=0;n<o.data.length;n+=4){0===o.data[n+3]&&t++}var i=t/(_w*_h)*100;return console.log("透明的点个数是"+t),console.log("占总面积的"+Math.ceil(i)+"%"),Math.round(i)}function clearRect(e){e.clearRect(0,0,_w,_h)}cas.addEventListener(clickEvtName,function(e){isMouseDown=!0;var t=e||window.event;moveX=device?t.touches[0].clientX:t.clientX,moveY=device?t.touches[0].clientY:t.clientY,drawT(context,moveX,moveY)},!1),cas.addEventListener(moveEvt,function(e){if(!0===isMouseDown){var t=e||window.event;t.preventDefault();var o=device?t.touches[0].clientX:t.clientX,n=device?t.touches[0].clientY:t.clientY;drawT(context,moveX,moveY,o,n),moveX=o,moveY=n}},!1),cas.addEventListener(endEvt,fn3,!1),window.onload=function(){drawMask(context),drawarc(context),drawLine(context)};